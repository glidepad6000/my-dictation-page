<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>英文聽寫練習</title>
  <style>
    body {
      font-family: sans-serif;
      margin: 20px;
    }
    #videoInput {
      width: 100%;
      padding: 8px;
      font-size: 16px;
    }
    #videoContainer {
      margin-top: 20px;
    }
    iframe {
      width: 640px;
      height: 360px;
      border: none;
    }
    #dictationArea {
      margin-top: 40px;
    }
    #toolbar button {
      margin-right: 5px;
      margin-bottom: 5px;
    }
    #editor {
      border: 1px solid #ccc;
      padding: 10px;
      min-height: 200px;
      font-size: 16px;
      line-height: 1.5;
    }
  </style>
</head>
<body>

  <h2>🎬 影片區</h2>
  <input id="videoInput" type="text" placeholder="貼上 Bilibili 或 YouTube 影片網址後按 Enter">
  <div id="videoContainer"></div>

  <div id="dictationArea">
    <h2>📝 聽寫區</h2>
    <div id="toolbar">
      <button onclick="format('bold')">粗體</button>
      <button onclick="format('italic')">斜體</button>
      <button onclick="format('underline')">底線</button>
      <button onclick="format('strikeThrough')">刪除線</button>
      <button onclick="insertFold()">插入折疊區塊</button>
      <button onclick="removeFold()">刪除選取的折疊區</button>
      <button onclick="insertColor('🔴')">🔴</button>
      <button onclick="insertColor('🩷')">🩷</button>
      <button onclick="insertColor('🟡')">🟡</button>
    </div>
    <div id="editor" contenteditable="true">
      在此輸入聽寫內容...
    </div>
  </div>

  <script>
    // 🎬 影片嵌入邏輯
    const input = document.getElementById('videoInput');
    const container = document.getElementById('videoContainer');

    input.addEventListener('keydown', function(e) {
      if (e.key === 'Enter') {
        e.preventDefault();
        const url = input.value.trim();

        const biliMatch = url.match(/bilibili\.com\/video\/(BV\w+)/);
        if (biliMatch) {
          const bvid = biliMatch[1];
          container.innerHTML = `
            <iframe src="https://player.bilibili.com/player.html?bvid=${bvid}&autoplay=0"
                    allowfullscreen></iframe>`;
          return;
        }

        const ytMatch = url.match(/(?:youtube\.com\/watch\\?v=|youtu\\.be\\/)([\\w-]{11})/);
        if (ytMatch) {
          const vid = ytMatch[1];
          container.innerHTML = `
            <iframe src="https://www.youtube.com/embed/${vid}"
                    allowfullscreen></iframe>`;
          return;
        }

        container.innerHTML = `<p style="color:red;">⚠️ 無法辨識的影片網址</p>`;
      }
    });

    // 📝 聽寫格式工具列功能
    function format(command) {
      document.execCommand(command, false, null);
    }

    function insertFold() {
      const selection = window.getSelection();
      if (selection.rangeCount > 0) {
        const range = selection.getRangeAt(0);
        const fold = document.createElement('details');
        const summary = document.createElement('summary');
        summary.textContent = '🔽 摺疊內容';
        fold.appendChild(summary);
        const content = document.createElement('div');
        content.innerHTML = range.toString();
        fold.appendChild(content);
        range.deleteContents();
        range.insertNode(fold);
      }
    }

    function removeFold() {
      const selection = window.getSelection();
      if (selection.rangeCount > 0) {
        const node = selection.anchorNode;
        const fold = node.closest('details');
        if (fold) fold.remove();
      }
    }

    function insertColor(symbol) {
      const selection = window.getSelection();
      if (selection.rangeCount > 0) {
        const range = selection.getRangeAt(0);
        range.deleteContents();
        range.insertNode(document.createTextNode(symbol));
      }
    }
  </script>

</body>
</html>
