<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Note Sidebar</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      background: #000;
      color: #eee;
      font-family: monospace;
      font-size: 16px;
      height: 100vh;
      overflow: hidden;
    }

    #toolbar {
      display: flex;
      gap: 6px;
      padding: 6px;
      background: #111;
      border-bottom: 1px solid #333;
    }

    #toolbar button {
      background: #222;
      color: #eee;
      border: none;
      padding: 4px 6px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
    }

    #toolbar button:hover {
      background: #444;
    }

    #note-content {
      padding: 10px;
      height: calc(100vh - 48px);
      overflow-y: auto;
      white-space: pre-wrap;
      outline: none;
    }

    .fold-block {
      margin: 0;
      padding: 0;
      border: 1px solid #444;
      background: #111;
      border-radius: 2px;
    }

    .fold-block summary {
      padding: 0;
      margin: 0;
      font-size: 14px;
      line-height: 1;
      color: #ffcc00;
    }

    .fold-content {
      padding: 0;
      margin: 0;
      font-size: 14px;
      line-height: 1.2;
      color: #eee;
    }

    .fold-content br {
      display: none;
    }

    ::selection {
      background: #444;
      color: #fff;
    }
  </style>
</head>
<body>

  <!-- Toolbar -->
  <div id="toolbar">
    <button onclick="exec('bold')">ğŸ…±ï¸</button>
    <button onclick="exec('italic')">ğ‘–</button>
    <button onclick="exec('underline')">UÌ²</button>
    <button onclick="exec('strikeThrough')">SÌ¶</button>
    <button id="add-fold">+</button>
    <button id="remove-fold">âˆ’</button>
    <button class="rgb-btn" data-color="#ff0000">ğŸ”´</button>
    <button class="rgb-btn" data-color="#00ff00">ğŸŸ¢</button>
    <button class="rgb-btn" data-color="#0000ff">ğŸ”µ</button>
  </div>
<!-- ä¸Šæ–¹æŠ˜ç–Šå€ï¼šæ”¶ç·Š -->
<p>é€™æ˜¯å‰æ–‡å…§å®¹</p>
<div class="fold-block folded">
  <div class="fold-header">Fold</div>
  <div class="fold-content">é€™æ˜¯æŠ˜ç–Šå…§å®¹</div>
</div>

<!-- ä¸‹æ–¹æŠ˜ç–Šå€ï¼šå±•é–‹ -->
<div class="fold-block expanded">
  <div class="fold-header">Fold</div>
  <div class="fold-content">
    ...
   é€™æ˜¯å±•é–‹å¾Œçš„ä¸­æ–‡å…§å®¹
   é€™æ˜¯ä¸‹ä¸€æ®µå…§å®¹
  </div>
</div>



  <!-- Note Area -->
  <div id="note-content" contenteditable="true" spellcheck="false"></div>

  <script>
    const noteContent = document.getElementById("note-content");

    // Save note
    noteContent.addEventListener("input", () => {
      localStorage.setItem("sideNote", noteContent.innerHTML);
      console.log("[Monitor] Note updated");
    });

    // Load note
    window.addEventListener("DOMContentLoaded", () => {
      const saved = localStorage.getItem("sideNote");
      if (saved) noteContent.innerHTML = saved;
      console.log("[Monitor] Note loaded");
    });

    // Format commands
    function exec(cmd) {
      document.execCommand(cmd);
      console.log(`[Monitor] Format applied: ${cmd}`);
    }

    // Add fold block (collapsed by default)
    document.getElementById("add-fold").addEventListener("click", () => {
      const block = document.createElement("div");
      block.className = "fold-block";
      block.innerHTML = `
        <details>
          <summary>Fold</summary>
          <div class="fold-content" contenteditable="true">...</div>
        </details>`;
      noteContent.appendChild(block);
      console.log("[Monitor] Fold block added");
    });

    // Remove fold block
    document.getElementById("remove-fold").addEventListener("click", () => {
      const sel = window.getSelection();
      if (!sel.rangeCount) return;
      const range = sel.getRangeAt(0);
      let node = range.startContainer;
      while (node && node !== noteContent) {
        if (node.classList?.contains("fold-block")) {
          node.remove();
          console.log("[Monitor] Fold block removed");
          break;
        }
        node = node.parentNode;
      }
    });

    // RGB color mixing
    let rgbMix = [];

    document.querySelectorAll(".rgb-btn").forEach(btn => {
      btn.addEventListener("click", () => {
        const color = btn.dataset.color;
        if (!rgbMix.includes(color)) rgbMix.push(color);
        console.log(`[Monitor] Color selected: ${color}`);
        if (rgbMix.length >= 2) {
          const mixed = mixRGB(rgbMix);
          document.execCommand("foreColor", false, mixed);
          console.log(`[Monitor] Mixed color applied: ${mixed}`);
          rgbMix = [];
        }
      });
    });

    function mixRGB(colors) {
      const r = colors.includes("#ff0000") ? 255 : 0;
      const g = colors.includes("#00ff00") ? 255 : 0;
      const b = colors.includes("#0000ff") ? 255 : 0;
      return rgbToHex(r, g, b);
    }

    function rgbToHex(r, g, b) {
      return "#" + [r, g, b].map(x => x.toString(16).padStart(2, "0")).join("");
    }

    // Prevent empty lines in fold-content
    noteContent.addEventListener("keydown", e => {
      if (e.key === "Enter") {
        const sel = window.getSelection();
        const node = sel.anchorNode;
        if (node && node.closest(".fold-content")) {
          e.preventDefault();
          console.log("[Monitor] Enter blocked in fold-content");
        }
      }
    });
  </script>

</body>
</html>
