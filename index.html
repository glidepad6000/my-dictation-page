const note = document.getElementById("note");
const buttons = document.querySelectorAll("#toolbar button");

// 儲存每個按鈕的狀態
const buttonStates = new Map();
buttons.forEach(btn => buttonStates.set(btn, false));

// 自動儲存筆記
note.innerHTML = localStorage.getItem("dictationNote") || "";
note.addEventListener("input", () => {
  localStorage.setItem("dictationNote", note.innerHTML);
});

// 格式切換（立即執行 + 可取消）
function toggleFormat(button, command) {
  const isActive = buttonStates.get(button);
  note.focus(); // 確保選取區域存在
  if (!isActive) {
    document.execCommand(command, false, null);
    button.classList.add("active");
    buttonStates.set(button, true);
  } else {
    // 嘗試取消格式（使用 removeFormat 或重複執行）
    if (command === "bold" || command === "italic" || command === "underline" || command === "strikeThrough") {
      document.execCommand(command, false, null); // 再執行一次以取消
    }
    button.classList.remove("active");
    buttonStates.set(button, false);
  }
}

// 套用顏色（立即執行 + 可取消）
function applyColor(button, color) {
  const isActive = buttonStates.get(button);
  note.focus();
  if (!isActive) {
    document.execCommand("foreColor", false, color);
    button.classList.add("active");
    buttonStates.set(button, true);
  } else {
    document.execCommand("foreColor", false, "#000000"); // 重設為黑色
    button.classList.remove("active");
    buttonStates.set(button, false);
  }
}


