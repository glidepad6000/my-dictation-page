<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>英文聽寫練習</title>
  <style>
    body {
      font-family: sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f8f8f8;
    }

    #container {
      display: flex;
      flex-direction: row;
      height: 100vh;
    }

    #leftPane, #rightPane {
      flex: 1;
      padding: 20px;
      box-sizing: border-box;
      overflow-y: auto;
    }

    #leftPane {
      background-color: #fff;
      border-right: 1px solid #ccc;
    }

    #rightPane {
      background-color: #fefefe;
    }

    h2 {
      margin-top: 0;
    }

    #videoInput {
      width: 100%;
      padding: 8px;
      font-size: 16px;
      margin-bottom: 10px;
    }

    #videoContainer {
      margin-top: 10px;
    }

    iframe {
      width: 100%;
      height: 360px;
      border: none;
    }

    #toolbar {
      margin-bottom: 10px;
    }

    #toolbar button {
      margin-right: 5px;
      margin-bottom: 5px;
      padding: 6px 10px;
      font-size: 14px;
      cursor: pointer;
    }

    #editor {
      border: 1px solid #ccc;
      padding: 10px;
      min-height: 400px;
      font-size: 16px;
      line-height: 1.5;
      background-color: #fff;
    }
  </style>
</head>
<body>
  <div id="container">
    <div id="leftPane">
      <h2>🎬 影片區</h2>
      <input id="videoInput" type="text" placeholder="貼上 Bilibili 或 YouTube 影片網址後按 Enter">
      <div id="videoContainer"></div>
    </div>
    <div id="rightPane">
      <h2>📝 聽寫區</h2>
      <div id="toolbar">
        <button onclick="format('bold')">B</button>
        <button onclick="format('italic')">I</button>
        <button onclick="format('underline')">U</button>
        <button onclick="format('strikeThrough')">S</button>
        <button onclick="insertFold()">⛶</button>
        <button onclick="removeFold()">⌧</button>
        <button onclick="insertColor('🔴')">🔴</button>
        <button onclick="insertColor('🩷')">🩷</button>
        <button onclick="insertColor('🟡')">🟡</button>
      </div>
      <div id="editor" contenteditable="true">
        在此輸入聽寫內容...
      </div>
    </div>
  </div>
  <script>
    // 🎬 嵌入影片邏輯（Bilibili + YouTube）
    const input = document.getElementById('videoInput');
    const container = document.getElementById('videoContainer');

    input.addEventListener('keydown', function(e) {
      if (e.key === 'Enter') {
        e.preventDefault();
        const url = input.value.trim();

        const biliMatch = url.match(/bilibili\.com\/video\/(BV\w+)/);
        if (biliMatch) {
          const bvid = biliMatch[1];
          container.innerHTML = `
            <iframe src="https://player.bilibili.com/player.html?bvid=${bvid}&autoplay=0"
                    width="100%" height="360" allowfullscreen></iframe>`;
          return;
        }

        const ytMatch = url.match(/(?:youtube\.com\/watch\\?v=|youtu\\.be\\/)([\\w-]{11})/);
        if (ytMatch) {
          const vid = ytMatch[1];
          container.innerHTML = `
            <iframe src="https://www.youtube.com/embed/${vid}"
                    width="100%" height="360" allowfullscreen></iframe>`;
          return;
        }

        container.innerHTML = `<p style="color:red;">⚠️ 無法辨識的影片網址</p>`;
      }
    });

    // 📝 聽寫格式工具列功能（保留原始邏輯）
    function format(command) {
      document.execCommand(command, false, null);
    }

    function insertFold() {
      const selection = window.getSelection();
      if (selection.rangeCount > 0) {
        const range = selection.getRangeAt(0);
        const fold = document.createElement('details');
        const summary = document.createElement('summary');
        summary.textContent = '🔽 摺疊內容';
        fold.appendChild(summary);
        const content = document.createElement('div');
        content.innerHTML = range.toString();
        fold.appendChild(content);
        range.deleteContents();
        range.insertNode(fold);
      }
    }

    function removeFold() {
      const selection = window.getSelection();
      if (selection.rangeCount > 0) {
        const node = selection.anchorNode;
        const fold = node.closest('details');
        if (fold) fold.remove();
      }
    }

    function insertColor(symbol) {
      const selection = window.getSelection();
      if (selection.rangeCount > 0) {
        const range = selection.getRangeAt(0);
        range.deleteContents();
        range.insertNode(document.createTextNode(symbol));
      }
    }
  </script>
</body>
</html>
